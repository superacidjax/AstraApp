<div data-controller="people-rule-builder" data-people-rule-builder-traits-value="<%= @traits.to_json(only: [ :id, :name, :client_application_id, :value_type ]) %>">
  <div class="form-group">
    <label for="rule_name">Rule Name</label>
    <input type="text" id="rule_name" name="rule[name]" class="form-control">
  </div>

  <div class="form-group">
    <label for="client_applications">Client Application</label>
    <select id="client_applications" name="rule[client_application_ids][]" 
      class="form-control" multiple 
      data-people-rule-builder-target="clientApplications" 
      data-action="change->people-rule-builder#filterTraits">
      <option value="all">All Applications</option>
      <% client_applications.each do |client_app| %>
        <option value="<%= client_app.id %>">
          <%= client_app.name %>
        </option>
      <% end %>
    </select>
  </div>

  <div class="form-group">
    <label for="traits">Trait</label>
    <select id="traits" name="rule[trait_id]" class="form-control" 
      data-people-rule-builder-target="traitSelector"
      data-action="change->people-rule-builder#updateOperator">
      <option value="">Select a trait</option>
    </select>
  </div>

  <!-- Operator Dropdown, fixed target reference -->
  <div class="form-group" data-people-rule-builder-target="operatorGroup">
    <label for="operator">Operator</label>
    <select id="operator" name="rule[operator]" class="form-control" 
      data-people-rule-builder-target="operatorSelector"> <!-- Make sure this target exists -->
      <option value="">Select an operator</option>
    </select>
  </div>

  <!-- Case sensitive checkbox, only for text traits -->
  <div class="form-group" data-people-rule-builder-target="caseSensitiveGroup" style="display: none;">
    <label for="case_sensitive">Case sensitive</label>
    <input type="checkbox" id="case_sensitive" name="rule[case_sensitive]" value="true">
  </div>

  <!-- Input fields depending on operator -->
  <div class="form-group" data-people-rule-builder-target="valueInputGroup">
    <!-- Placeholder for dynamic fields -->
  </div>

  <button type="submit" class="btn btn-primary">Save Rule</button>
</div>
